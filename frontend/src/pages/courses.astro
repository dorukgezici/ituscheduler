---
import CourseTable from "@/components/CourseTable";
import Layout from "@/layouts/Layout.astro";
import { serverComponentClient } from "@/lib/supabaseClient";
import { $selectedMajor } from "@/store/courses";

const supabase = serverComponentClient(Astro.cookies);

const { data: majors } = await supabase.from("majors").select("code").order("code");
const { data: courseCodes } = await supabase.from("course_codes").select().eq("major_code", $selectedMajor.get());
const { data: courses } = await supabase
  .from("courses")
  .select("*, lectures(*)")
  .eq("major_code", $selectedMajor.get());
const { data: selectedMajor } = await supabase
  .from("majors")
  .select("refreshed_at")
  .eq("code", $selectedMajor.get())
  .single();
---

<Layout title="Courses | ITU Scheduler">
  <CourseTable majors={majors} courseCodes={courseCodes} courses={courses} selectedMajor={selectedMajor} client:load />
</Layout>
